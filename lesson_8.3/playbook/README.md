### Что делает playbook
- Устанавливает `clickhouse`
- Устанавливает `vector`
- Устанавливает `lighthouse`

### Требования
- Ansible **2.14+**
- CentOS8, OL8, Alma linux 8

### Конфигурация

Для изменения параметров по умолчанию перейдите в каталог  `group_vars`

`clickhouse/vars.yml`

| Переменная            | Описание                                                   |
| :-------------------- | :--------------------------------------------------------- |
| `clickhouse_version`  | Версия `clickhouse`. Например: `22.3.3.44`                 |
| `clickhouse_packages` | Список пакетов `clickhouse`. Например: `clickhouse-client` |

`vector/vars.yml`

| Переменная          | Описание                                                             |
| :------------------ | :------------------------------------------------------------------- |
| `vector_version`    | Версия `vector`. Например: `0.32.1`                                  |
| `vector_config_dir` | Путь где будет находиться файл конфигурации. Например: `/etc/vector` |

`lighthouse/vars.yml`

| Переменная        | Описание                                                                    |
| :---------------- | :-------------------------------------------------------------------------- |
| `lighthouse_repo` | Репозиторий `lighthouse`. Например: https://github.com/VKCOM/lighthouse.git |
| `lighthouse_dir`  | Путь где будет находиться `lighthouse`. Например: `/opt/lighthouse`         |

Для изменения параметров подключения отредактируйте `inventory/inventory.yml`. 

| Группа хостов | Описание                                        |
| :------------ | :---------------------------------------------- |
| `clickhouse`  | Хосты, на которые будет установлен `clickhouse` |
| `vector`      | Хосты, на которые будет установлен `vector`     |
| `lighthouse`  | Хосты, на которые будет установлен `lighthouse` |

Для изменения конфигурационных файлов перейдите в каталог `templates`

| Шаблон               | Описание                                      |
| -------------------- | --------------------------------------------- |
| `vector.service.j2`  | Создает `Unit` для запуска службы `vector`    |
| `vector.toml.j2 `    | Создает конфигурацию для `vector`             |
| `nginx.conf.j2`      | Создает конфигурацию для `nginx`              |
| `lighthouse.conf.j2` | Создает конфигурацию `nginx` для `lighthouse` |

### Playbook

Состоит из 2 `play`
1. `Install Clickhouse` распространяется на группу `clickhouse`, скачивает и устанавливает `clickhouse` указанной версии.
2. `Install Vector` распространяется на группу `vector`, скачивает и устанавливает `vector` указанной версии.
3. `Install nginx` распространяется на группу `lighthouse`, устанавливает и настраивает `nginx`.
4. `Install lighthouse` распространяется на группу `lighthouse`, скачивает `lighthouse`, настраивает `nginx`.

### Запуск

Для запуска выполните:
```bash
ansible-playbook -i inventory/prod.yml site.yml
```